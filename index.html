<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>FPS Arena</title>
<style>
html,body{margin:0;overflow:hidden;background:#d0d0d0}
#hud{position:fixed;top:10px;left:10px;font:bold 18px Arial}
#cross{position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);font-size:30px}
#shoot{position:fixed;bottom:40px;right:40px;width:70px;height:70px;border-radius:50%;background:darkred;color:white;font-size:24px;border:none}
#joy{position:fixed;bottom:40px;left:40px;width:120px;height:120px;border-radius:50%;background:rgba(0,0,0,.2)}
</style>
</head>
<body>

<div id="hud">‚ù§Ô∏è Vida: 100</div>
<div id="cross">+</div>
<button id="shoot">üî´</button>
<div id="joy"></div>

<script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>

<script>
const scene=new THREE.Scene();
scene.background=new THREE.Color(0xd0d0d0);

const camera=new THREE.PerspectiveCamera(75,innerWidth/innerHeight,0.1,1000);
camera.position.y=1.6;

const renderer=new THREE.WebGLRenderer({antialias:true});
renderer.setSize(innerWidth,innerHeight);
document.body.appendChild(renderer.domElement);

// LUZ
scene.add(new THREE.HemisphereLight(0xffffff,0x444444,1));

// CH√ÉO
const floor=new THREE.Mesh(
  new THREE.PlaneGeometry(200,200),
  new THREE.MeshStandardMaterial({color:0xaaaaaa})
);
floor.rotation.x=-Math.PI/2;
scene.add(floor);

// MAPA
function wall(x,z,w,d){
  const m=new THREE.Mesh(
    new THREE.BoxGeometry(w,3,d),
    new THREE.MeshStandardMaterial({color:0x8b0000})
  );
  m.position.set(x,1.5,z);
  scene.add(m);
}
wall(0,-10,6,3);
wall(0,10,6,3);
wall(-8,0,3,10);
wall(8,0,3,10);

// CONTROLES
let yaw=0;
let moveX=0, moveY=0;

// JOYSTICK
const joy=document.getElementById("joy");
joy.addEventListener("touchmove",e=>{
  const t=e.touches[0];
  const r=joy.getBoundingClientRect();
  moveX=(t.clientX-(r.left+r.width/2))/40;
  moveY=(t.clientY-(r.top+r.height/2))/40;
});
joy.addEventListener("touchend",()=>{moveX=0;moveY=0});

// MIRA MOBILE
let lastX=null;
addEventListener("touchmove",e=>{
  if(e.target.id==="joy")return;
  if(lastX!==null) yaw-=(e.touches[0].clientX-lastX)*0.005;
  lastX=e.touches[0].clientX;
});
addEventListener("touchend",()=>lastX=null);

// PC
const keys={};
addEventListener("keydown",e=>keys[e.key]=true);
addEventListener("keyup",e=>keys[e.key]=false);
addEventListener("mousemove",e=>{
  if(document.pointerLockElement) yaw-=e.movementX*0.002;
});
addEventListener("click",()=>document.body.requestPointerLock());

// TIRO
const bullets=[];
document.getElementById("shoot").onclick=()=>{
  const b=new THREE.Mesh(
    new THREE.SphereGeometry(0.05),
    new THREE.MeshBasicMaterial({color:"yellow"})
  );
  b.position.copy(camera.position);
  b.dir=new THREE.Vector3(Math.sin(yaw),0,Math.cos(yaw));
  scene.add(b);bullets.push(b);
};

// LOOP
function loop(){
  requestAnimationFrame(loop);

  camera.rotation.y=yaw;

  let forward=(keys.w?1:0)-(keys.s?1:0);
  let side=(keys.d?1:0)-(keys.a?1:0);

  forward+=moveY;
  side+=moveX;

  const speed=0.08;
  camera.position.x+=Math.sin(yaw)*forward*speed;
  camera.position.z+=Math.cos(yaw)*forward*speed;
  camera.position.x+=Math.sin(yaw+Math.PI/2)*side*speed;
  camera.position.z+=Math.cos(yaw+Math.PI/2)*side*speed;

  bullets.forEach((b,i)=>{
    b.position.add(b.dir.clone().multiplyScalar(0.5));
    if(b.position.length()>200){scene.remove(b);bullets.splice(i,1);}
  });

  renderer.render(scene,camera);
}
loop();
</script>
</body>
</html>
