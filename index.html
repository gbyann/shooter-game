<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>FPS Arena</title>
<style>
html,body{margin:0;overflow:hidden;background:#cfcfcf}
#hud{
  position:fixed;top:10px;left:10px;
  font-family:Arial;font-size:18px;font-weight:bold
}
#cross{
  position:fixed;left:50%;top:50%;
  transform:translate(-50%,-50%);
  font-size:30px;pointer-events:none
}
#shoot{
  position:fixed;bottom:40px;right:40px;
  width:70px;height:70px;border-radius:50%;
  background:darkred;color:white;font-size:26px;border:none
}
#joy{
  position:fixed;bottom:40px;left:40px;
  width:120px;height:120px;border-radius:50%;
  background:rgba(0,0,0,.2)
}
</style>
</head>
<body>

<div id="hud">‚ù§Ô∏è Vida: <span id="life">100</span></div>
<div id="cross">+</div>
<button id="shoot">üî´</button>
<div id="joy"></div>

<script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>

<script>
const scene=new THREE.Scene();
scene.background=new THREE.Color(0xcfcfcf);

const camera=new THREE.PerspectiveCamera(75,innerWidth/innerHeight,0.1,1000);
camera.position.y=1.6;

const renderer=new THREE.WebGLRenderer({antialias:true});
renderer.setSize(innerWidth,innerHeight);
document.body.appendChild(renderer.domElement);

// LUZ
scene.add(new THREE.HemisphereLight(0xffffff,0x444444,1));

// CH√ÉO
const floor=new THREE.Mesh(
  new THREE.PlaneGeometry(200,200),
  new THREE.MeshStandardMaterial({color:0x999999})
);
floor.rotation.x=-Math.PI/2;
scene.add(floor);

// MAPA (BLOCOS)
const blocks=[];
function block(x,z,w,d){
  const b=new THREE.Mesh(
    new THREE.BoxGeometry(w,3,d),
    new THREE.MeshStandardMaterial({color:0x8b0000})
  );
  b.position.set(x,1.5,z);
  scene.add(b);blocks.push(b);
}
block(0,-10,6,3);
block(-6,0,3,8);
block(6,0,3,8);
block(0,10,8,3);
block(12,0,3,12);
block(-12,0,3,12);

// CONTROLE
let yaw=0,pitch=0;
let move={x:0,y:0};

const joy=document.getElementById("joy");
joy.addEventListener("touchmove",e=>{
  const t=e.touches[0];
  const r=joy.getBoundingClientRect();
  move.x=(t.clientX-(r.left+r.width/2))/50;
  move.y=(t.clientY-(r.top+r.height/2))/50;
});
joy.addEventListener("touchend",()=>move={x:0,y:0});

addEventListener("touchmove",e=>{
  if(e.target.id==="joy")return;
  yaw-=e.touches[0].movementX*0.003;
  pitch-=e.touches[0].movementY*0.003;
});

addEventListener("mousemove",e=>{
  if(document.pointerLockElement)
    yaw-=e.movementX*0.002;
});

addEventListener("click",()=>document.body.requestPointerLock());

// TIRO
const bullets=[];
document.getElementById("shoot").onclick=()=>{
  const b=new THREE.Mesh(
    new THREE.SphereGeometry(0.05),
    new THREE.MeshBasicMaterial({color:"yellow"})
  );
  b.position.copy(camera.position);
  b.dir=new THREE.Vector3(
    Math.sin(yaw),0,Math.cos(yaw)
  );
  scene.add(b);bullets.push(b);
};

// LOOP
function animate(){
  requestAnimationFrame(animate);

  camera.rotation.y=yaw;
  camera.rotation.x=pitch;

  const speed=.08;
  camera.position.x+=Math.sin(yaw)*move.y*speed;
  camera.position.z+=Math.cos(yaw)*move.y*speed;
  camera.position.x+=Math.sin(yaw+Math.PI/2)*move.x*speed;
  camera.position.z+=Math.cos(yaw+Math.PI/2)*move.x*speed;

  bullets.forEach((b,i)=>{
    b.position.add(b.dir.clone().multiplyScalar(0.5));
    if(b.position.length()>200){
      scene.remove(b);bullets.splice(i,1);
    }
  });

  renderer.render(scene,camera);
}
animate();
</script>
</body>
</html>
