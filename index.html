<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>FPS Arena</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
html, body {
  margin: 0;
  padding: 0;
  overflow: hidden;
  background: #000;
}
canvas {
  display: block;
}
#hud {
  position: fixed;
  top: 10px;
  left: 10px;
  color: white;
  font-family: Arial;
  font-size: 14px;
}
#crosshair {
  position: fixed;
  top: 50%;
  left: 50%;
  width: 20px;
  height: 20px;
  margin-left: -10px;
  margin-top: -10px;
}
#crosshair:before, #crosshair:after {
  content: "";
  position: absolute;
  background: white;
}
#crosshair:before {
  width: 20px;
  height: 2px;
  top: 9px;
}
#crosshair:after {
  width: 2px;
  height: 20px;
  left: 9px;
}
</style>
</head>

<body>
<canvas id="game"></canvas>
<div id="hud">❤️ Vida: 100</div>
<div id="crosshair"></div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

// ===== MAPA (CS STYLE) =====
const map = [
  "111111111111",
  "1..........1",
  "1..1111....1",
  "1......1...1",
  "1..1.......1",
  "1....111...1",
  "1..........1",
  "111111111111"
];
const TILE = 64;

// ===== PLAYER =====
let player = {
  x: 150,
  y: 150,
  angle: 0,
  speed: 2
};

// ===== CONTROLES =====
let keys = {};
document.addEventListener("keydown", e => keys[e.key] = true);
document.addEventListener("keyup", e => keys[e.key] = false);

// ===== MOUSE (PC) =====
canvas.requestPointerLock = canvas.requestPointerLock || canvas.mozRequestPointerLock;
document.addEventListener("click", () => canvas.requestPointerLock());
document.addEventListener("mousemove", e => {
  if (document.pointerLockElement === canvas) {
    player.angle += e.movementX * 0.003;
  }
});

// ===== TOQUE (MOBILE) =====
let touching = false;
let lastX = 0;

canvas.addEventListener("touchstart", e => {
  touching = true;
  lastX = e.touches[0].clientX;
});

canvas.addEventListener("touchend", () => touching = false);

canvas.addEventListener("touchmove", e => {
  if (!touching) return;
  let dx = e.touches[0].clientX - lastX;
  player.angle += dx * 0.004;
  lastX = e.touches[0].clientX;
});

// ===== RAYCAST =====
function castRay(angle) {
  let sin = Math.sin(angle);
  let cos = Math.cos(angle);

  for (let i = 0; i < 800; i++) {
    let x = player.x + cos * i;
    let y = player.y + sin * i;

    let mx = Math.floor(x / TILE);
    let my = Math.floor(y / TILE);

    if (map[my] && map[my][mx] === "1") {
      return i;
    }
  }
  return 800;
}

// ===== GAME LOOP =====
function game() {
  ctx.fillStyle = "#222";
  ctx.fillRect(0, 0, canvas.width, canvas.height / 2);
  ctx.fillStyle = "#555";
  ctx.fillRect(0, canvas.height / 2, canvas.width, canvas.height / 2);

  const FOV = Math.PI / 3;
  const rays = canvas.width;

  for (let i = 0; i < rays; i++) {
    let rayAngle = player.angle - FOV / 2 + (i / rays) * FOV;
    let dist = castRay(rayAngle);
    let wallHeight = (TILE * 500) / dist;

    ctx.fillStyle = "#888";
    ctx.fillRect(
      i,
      canvas.height / 2 - wallHeight / 2,
      1,
      wallHeight
    );
  }

  // movimento
  if (keys["w"]) {
    player.x += Math.cos(player.angle) * player.speed;
    player.y += Math.sin(player.angle) * player.speed;
  }
  if (keys["s"]) {
    player.x -= Math.cos(player.angle) * player.speed;
    player.y -= Math.sin(player.angle) * player.speed;
  }
  if (keys["a"]) player.angle -= 0.05;
  if (keys["d"]) player.angle += 0.05;

  requestAnimationFrame(game);
}

game();
</script>
</body>
</html>
