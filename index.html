<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>FPS Web ‚Äì CS + Arena</title>
<style>
html,body{margin:0;overflow:hidden;background:#e9e9e9;font-family:Arial}
#hud{position:fixed;top:10px;left:10px;color:#000;font-weight:bold}
#cross{position:fixed;left:50%;top:50%;width:16px;height:16px;margin:-8px 0 0 -8px;pointer-events:none}
#cross:before,#cross:after{content:"";position:absolute;background:#000}
#cross:before{width:2px;height:16px;left:7px}
#cross:after{height:2px;width:16px;top:7px}
.btn{position:fixed;width:60px;height:60px;border-radius:50%;border:none;background:rgba(0,0,0,.6);color:#fff;font-size:20px}
#fw{bottom:120px;left:80px}
#bw{bottom:20px;left:80px}
#lt{bottom:70px;left:20px}
#rt{bottom:70px;left:140px}
#fire{bottom:70px;right:40px;background:#a00}
canvas{display:block}
</style>
</head>
<body>

<div id="hud">‚ù§Ô∏è Vida: <span id="life">100</span></div>
<div id="cross"></div>

<button id="fw" class="btn">‚ñ≤</button>
<button id="bw" class="btn">‚ñº</button>
<button id="lt" class="btn">‚óÄ</button>
<button id="rt" class="btn">‚ñ∂</button>
<button id="fire" class="btn">üî´</button>

<canvas id="c"></canvas>

<script>
/* ===== CONFIG ===== */
const canvas=document.getElementById("c");
const ctx=canvas.getContext("2d");
canvas.width=innerWidth; canvas.height=innerHeight;

const FOV=Math.PI/3;
const SPEED=0.08;
let life=100;

/* ===== MAPA (CS + ARENA) =====
1 = parede | 0 = ch√£o
Layout equilibrado, com arena central + corredores
*/
const map=[
[1,1,1,1,1,1,1,1,1,1,1,1],
[1,0,0,0,0,0,0,0,0,0,0,1],
[1,0,1,0,1,0,0,1,0,1,0,1],
[1,0,0,0,0,0,0,0,0,0,0,1],
[1,0,1,0,1,0,0,1,0,1,0,1],
[1,0,0,0,0,0,0,0,0,0,0,1],
[1,0,0,1,0,1,1,0,1,0,0,1],
[1,0,0,0,0,0,0,0,0,0,0,1],
[1,1,1,1,1,1,1,1,1,1,1,1]
];
const MW=map[0].length, MH=map.length;

/* ===== PLAYER ===== */
let px=2.5, py=2.5, pa=0;

/* ===== INPUT ===== */
const keys={};
addEventListener("keydown",e=>keys[e.key]=true);
addEventListener("keyup",e=>keys[e.key]=false);

// mouse (PC)
addEventListener("mousemove",e=>{
  if(document.pointerLockElement===document.body){
    pa+=e.movementX*0.002;
  }
});
document.body.onclick=()=>document.body.requestPointerLock();

// mobile
fw.ontouchstart=()=>keys["w"]=true;
bw.ontouchstart=()=>keys["s"]=true;
lt.ontouchstart=()=>keys["a"]=true;
rt.ontouchstart=()=>keys["d"]=true;
[fw,bw,lt,rt].forEach(b=>b.ontouchend=()=>keys[b.id==="fw"?"w":b.id==="bw"?"s":b.id==="lt"?"a":"d"]=false);

/* ===== RAYCAST ===== */
function castRay(angle){
  let sin=Math.sin(angle), cos=Math.cos(angle);
  for(let d=0; d<20; d+=0.02){
    let x=px+cos*d, y=py+sin*d;
    if(map[Math.floor(y)]?.[Math.floor(x)]===1){
      return d;
    }
  }
  return 20;
}

/* ===== LOOP ===== */
function loop(){
  requestAnimationFrame(loop);
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // movimento
  let nx=px, ny=py;
  if(keys["w"]){nx+=Math.cos(pa)*SPEED; ny+=Math.sin(pa)*SPEED}
  if(keys["s"]){nx-=Math.cos(pa)*SPEED; ny-=Math.sin(pa)*SPEED}
  if(keys["a"]){nx+=Math.cos(pa-Math.PI/2)*SPEED; ny+=Math.sin(pa-Math.PI/2)*SPEED}
  if(keys["d"]){nx+=Math.cos(pa+Math.PI/2)*SPEED; ny+=Math.sin(pa+Math.PI/2)*SPEED}
  if(map[Math.floor(py)]?.[Math.floor(nx)]===0) px=nx;
  if(map[Math.floor(ny)]?.[Math.floor(px)]===0) py=ny;

  // render 3D
  for(let x=0;x<canvas.width;x++){
    let ang=pa-FOV/2+FOV*x/canvas.width;
    let dist=castRay(ang)*Math.cos(ang-pa);
    let h=Math.min(canvas.height, canvas.height/(dist));
    let shade=200/(1+dist*dist*0.2);
    ctx.fillStyle=`rgb(${shade},${shade},${shade})`;
    ctx.fillRect(x,(canvas.height-h)/2,1,h);
  }

  document.getElementById("life").textContent=life;
}
loop();
</script>
</body>
</html>
